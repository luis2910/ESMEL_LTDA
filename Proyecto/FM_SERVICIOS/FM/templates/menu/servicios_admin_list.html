{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Servicios - Administración</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'menu/css/style.css' %}?v=20241205">
  <style>
    :root {
      --admin-blue: rgb(0, 19, 93);
      --card-border: #e6e9f2;
      --muted: #6b7280;
      --soft: #f6f8ff;
    }
    body { background: #f5f7fb; }
    .page-shell { max-width: 1100px; }
    .hero {
      background: #fff;
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }
    .hero-title { margin: 0; color: var(--admin-blue); font-weight: 800; }
    .hero-subtitle { margin: 0; color: var(--muted); }
    .pill {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 999px;
      background: rgba(0,19,93,0.08); color: var(--admin-blue);
      border: 1px solid rgba(0,19,93,0.14); font-weight: 700;
    }
    .service-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 14px; margin-top: 18px; }
    .service-card {
      background: #fff;
      border: 1px solid var(--card-border);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .service-card h3 { margin: 0; font-size: 1.05rem; font-weight: 800; color: #0f172a; }
    .service-card p { margin: 0; color: var(--muted); }
    .badge-pub { font-size: 0.8rem; }
    .meta { font-size: 0.88rem; color: var(--muted); }
    .actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .btn-outline-danger { --bs-btn-border-color: #f05252; --bs-btn-color: #b91c1c; --bs-btn-hover-bg: #f05252; --bs-btn-hover-border-color: #f05252; --bs-btn-hover-color: #fff; }
    .btn-outline-secondary { --bs-btn-border-color: var(--admin-blue); --bs-btn-color: var(--admin-blue); --bs-btn-hover-bg: var(--admin-blue); --bs-btn-hover-border-color: var(--admin-blue); --bs-btn-hover-color: #fff; }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">

  {% include 'menu/partials/navbar.html' %}

  <main class="container my-5 flex-grow-1 page-shell">
    {% if request.user.is_authenticated %}
      {% if request.user.is_staff or request.user.is_superuser %}
        <div class="mb-3">
          <a href="{% url 'admin_dashboard' %}" class="btn btn-link p-0 text-decoration-none">&larr; Volver a administrar</a>
        </div>
      {% endif %}
    {% endif %}

    {% if messages %}
      <div class="mb-3">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <section class="hero mb-3">
      <div>
        <div class="d-flex align-items-center gap-2 mb-1">
          <span class="pill">Servicios (Administración)</span>
          <span class="text-muted small">Total: {{ servicios|length }}</span>
        </div>
        <h1 class="hero-title h4">Gestiona el catálogo y mantén la información al día</h1>
        <p class="hero-subtitle">Edita, reordena o elimina servicios publicados.</p>
      </div>
      <a class="btn btn-primary" href="{% url 'servicio_crear' %}">Nuevo servicio</a>
    </section>

    {% if servicios %}
      <div class="service-grid">
        {% for s in servicios %}
          <article class="service-card">
            <div class="d-flex align-items-start justify-content-between gap-2">
              <h3 class="mb-0">{{ s.titulo }}</h3>
              {% if s.publicado %}
                <span class="badge bg-success badge-pub">Publicado</span>
              {% else %}
                <span class="badge bg-secondary badge-pub">Borrador</span>
              {% endif %}
            </div>
            {% if s.resumen %}<p class="small">{{ s.resumen|truncatechars:140 }}</p>{% endif %}
            <div class="meta">
              <span class="me-2">Slug: {{ s.slug|default:"-" }}</span>
              <span class="me-2">Orden: {{ s.orden|default:"-" }}</span>
            </div>
            <div class="actions">
              <a class="btn btn-sm btn-outline-secondary" href="{% url 'servicio_editar' s.pk %}">Editar</a>
              <form method="post" action="{% url 'servicio_eliminar' s.pk %}" onsubmit="return confirm('¿Eliminar servicio?');">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-danger" type="submit">Eliminar</button>
              </form>
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <div class="bg-white p-5 text-center rounded shadow-sm border" style="border-color: var(--card-border);">
        <p class="mb-0 text-muted">No hay servicios aún.</p>
      </div>
    {% endif %}
  </main>

  {% include 'menu/partials/footer.html' %}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
